# çº¢é»‘æ ‘(Red-Black Trees)
![img_5.png](./static/img_5.png)

* [åŸºç¡€æ¦‚å¿µ](#basic)
* [Balanced Search Treeså¹³è¡¡æ€§](#balance)
* [çº¢é»‘æ ‘çš„åº”ç”¨åœºæ™¯](#scenarios)
* [çº¢é»‘æ ‘çš„ç‰¹æ€§](#feature)
* [çº¢é»‘æ ‘å¹³è¡¡æ€§è¯æ˜](#proof)
* [2-3æ ‘](#23tree)
* [å·¦å€¾çº¢é»‘æ ‘](#left_leaning_tree)

<h4 id="basic">åŸºç¡€æ¦‚å¿µ</h4>

* å…³äºO

  æœ‰ç›¸åŒå¢é•¿ç‡çš„ä¸åŒå‡½æ•°å¯ä»¥ä½¿ç”¨åŒæ ·çš„Oå‡½æ•°æ¥è¡¨ç¤º
  ```
  f(x) = O(x) å…¶ä¸­çš„=å·å¹¶ä¸æ˜¯æˆ‘ä»¬ä¼ ç»Ÿæ„ä¹‰ç†è§£çš„ç­‰äºå·ï¼Œè€Œæ˜¯å±äº 
  å¦ä¸€ç§è¡¨è¾¾æ–¹å¼å±äº f(x) âˆˆ O(x)
  ```
  
* å…³äºlg
  
  ```
  ISOï¼ˆå›½é™…åŒ–æ ‡å‡†ç»„ç»‡ï¼‰æ ‡å‡†æ˜¯ä»¥10ä¸ºåº•
  è®¡ç®—æœºç§‘å­¦é¢†åŸŸæ˜¯ä»¥2ä¸ºåº•
  ```

* ç®€å•è·¯å¾„
  
  ```
  å¦‚æœè·¯å¾„ä¸Šçš„å„é¡¶ç‚¹å‡ä¸ç›¸äº’é‡å¤ï¼Œç§°è¿™æ ·çš„è·¯å¾„ä¸ºç®€å•è·¯å¾„
  ```
  
* æ ‘çš„æ·±åº¦å’Œé«˜åº¦
  
  ```
  æ·±åº¦ï¼šä»æŸèŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹è¾¹çš„ä¸ªæ•°
  é«˜åº¦ï¼šä»æŸèŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æœ€å¤§è¾¹çš„ä¸ªæ•°ï¼ˆä»æŸèŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æœ€é•¿è·¯å¾„ï¼‰
  ```

<h4 id="balance">Balanced Search Treeså¹³è¡¡æ€§</h4>

* ä¸¥æ ¼å¹³è¡¡ï¼šä»»æ„èŠ‚ç‚¹çš„ä¸¤é¢—å­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼`<=1`

* è¿‘ä¼¼å¹³è¡¡ï¼šåªè¦æ»¡è¶³æ ‘çš„é«˜åº¦ä¸º`O(lgn)`ï¼Œåˆ™è¯¥æ ‘æ˜¯ä¸€é¢—å¹³è¡¡æ ‘

<h4 id='scenarios'>çº¢é»‘æ ‘çš„åº”ç”¨åœºæ™¯</h4>

* `Java`ä¸­çš„`TreeMap, TreeSet`çš„å®ç°
  
* `nginx`ä¸­çš„`Timer`ç®¡ç†

* `Linux`ä¸­è™šæ‹Ÿå†…å­˜çš„ç®¡ç†

* `C++ STL`å®ç°äº†çº¢é»‘æ ‘

<h4 id='feature'>çº¢é»‘æ ‘çš„ç‰¹æ€§</h4>

1. ä»»æ„èŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰²
   
2. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
   
3. çº¢è‰²èŠ‚ç‚¹ä¸èƒ½è¿ç»­å‡ºç°ï¼Œå®ƒçš„çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²
   
4. ä»»æ„èŠ‚ç‚¹åˆ°å®ƒåä»£å¶èŠ‚ç‚¹çš„æ‰€æœ‰ç®€å•è·¯å¾„åŒ…å«æœ‰ç›¸åŒæ•°é‡çš„é»‘è‰²èŠ‚ç‚¹

<h4 id='proof'>çº¢é»‘æ ‘å¹³è¡¡æ€§è¯æ˜</h4>

```
nä¸ºçº¢é»‘æ ‘ä¸­èŠ‚ç‚¹ä¸ªæ•°
BH(x)ä¸ºxåˆ°å¶èŠ‚ç‚¹é»‘è‰²èŠ‚ç‚¹çš„ä¸ªæ•°

h >= BH(x) >= h/2

n >= 2**BH(x) - 1
n >= 2**(h/2) - 1
lg(n+1) >= lg(2**(h/2))
lg(n+1) >= h/2
h <= 2lg(n+1)
h = O(lg(n))
```
[`lg(ğ‘›+1) âˆˆ ğ‘‚(lgğ‘›)`è¯æ˜](https://cs.stackexchange.com/questions/54157/can-i-simplify-logn1-before-showing-that-it-is-in-olog-n/54159)

<h4 id='23tree'>2-3æ ‘</h4>

![img_10.png](./static/img_10.png)

* æ¯ä¸ªèŠ‚ç‚¹å…è®¸1æˆ–2ä¸ª`key`
  
    * 2-èŠ‚ç‚¹ï¼šä¸€ä¸ª`key`ï¼Œä¸¤ä¸ªå­©å­èŠ‚ç‚¹
      
    * 3-èŠ‚ç‚¹: ä¸€ä¸ª`key`ï¼Œä¸‰ä¸ªå­©å­èŠ‚ç‚¹
  
* ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦ç›¸åŒ

* æ ‘é«˜
  
    * æœ€åæƒ…å†µä¸‹`O(lgn)`
      
    * æœ€å¥½æƒ…å†µä¸‹`O(log3**n)`çº¦ç­‰äº`0.631lgn`
      
    * æ ‘é«˜åœ¨12åˆ°20å±‚å¯ä»¥å­˜å‚¨ç™¾ä¸‡ä¸ª`key`
      
    * æ ‘é«˜åœ¨18åˆ°30å±‚å¯ä»¥å­˜å‚¨åäº¿ä¸ª`key`

* å†™å…¥`K`åˆ°2-èŠ‚ç‚¹

![img_11.png](./static/img_11.png)
  
* å†™å…¥`Z`åˆ°3-èŠ‚ç‚¹

![img_12.png](./static/img_12.png)
![img_13.png](./static/img_13.png)

* å†™å…¥`L`åˆ°3-èŠ‚ç‚¹

![img_14.png](./static/img_14.png)

![img_15.png](./static/img_15.png)

![img_16.png](./static/img_16.png)

<h4 id="left_leaning_tree"> å·¦å€¾çº¢é»‘æ ‘ï¼ˆleft leaning red-black treeï¼‰</h4>

![img_18.png](./static/img_18.png)

å·¦å€¾çº¢é»‘æ ‘çš„ç‰¹ç‚¹

  * æ²¡æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²è·¯å¾„

  * ä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹åŒ…å«ç›¸åŒæ•°é‡çš„é»‘è‰²è·¯å¾„

  * æ‰€æœ‰çº¢è‰²è·¯å¾„å·¦å€¾

æ—‹è½¬å’Œå˜è‰²

* çº¢é»‘æ ‘å·¦æ—‹

![left_rotate.gif](./static/left_rotate.gif)

![img_32.png](./static/img_32.png)

![img_33.png](./static/img_33.png)

* çº¢é»‘æ ‘å³æ—‹

![right_rotate.gif](./static/right_rotate.gif)

![img_30.png](./static/img_30.png)

![img_31.png](./static/img_31.png)

* å˜è‰²

![img_6.png](./static/img_6.png)
![img_9.png](./static/img_9.png)

ä»…æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†™å…¥æ–°èŠ‚ç‚¹
   
  ![img_20.png](./static/mg_20.png)

å†™å…¥åˆ°2-èŠ‚ç‚¹

![img_21.png](./static/img_21.png)

ä»…æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå†™å…¥æ–°èŠ‚ç‚¹

![img_22.png](./static/img_22.png)

å†™å…¥åˆ°3-èŠ‚ç‚¹

![img_23.png](./static/img_23.png)

![img_24.png](./static/img_24.png)

å†™å…¥åˆ°3-èŠ‚ç‚¹

![img_23.png](./static/img_23.png)
![img_24.png](./static/img_24.png)

å‡åºå†™å…¥255ä¸ªèŠ‚ç‚¹

![rb_asc_insert.gif](./static/rb_asc_insert.gif)

é™åºå†™å…¥255ä¸ªèŠ‚ç‚¹

![rb_desc_insert.gif](./static/rb_desc_insert.gif)

éšæœºå†™å…¥255ä¸ªèŠ‚ç‚¹

![rb_random_insert.gif](./static/rb_random_insert.gif)







